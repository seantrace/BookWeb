@if (record != null)
{
    <h2>@CalibreRecordType.ToString() : @record.Name</h2>
    @switch (CalibreRecordType)
    {
        case CalibreRecordType.Author:
            <MudDivider />
            <MudGrid>
                <MudItem xs="2">
                    <MudTooltip Text="Add Author Image">
                        <img @onclick="@ToggleOpen" style="border-radius:50%;" src="/media/Actions-contact-new-icon.png" />
                    </MudTooltip>
                </MudItem>
                <MudItem xs="8">
                    <h3>Biography:</h3>
                    @{ string bio = "Lee Child is one of the world's leading thriller writers. He was born in Coventry, raised in Birmingham, and now lives in New York. It is said one of his novels featuring his hero Jack Reacher is sold somewhere in the world every nine seconds. His books consistently achieve the number-one slot on bestseller lists around the world and have sold over one hundred million copies. Two blockbusting Jack Reacher movies have been made so far. He is the recipient of many awards, most recently Author of the Year at the 2019 British Book Awards. He was appointed CBE in the 2019 Queen's Birthday Honours.";}
                    <MudText Typo="Typo.body1"> @((MarkupString)bio)</MudText>
                </MudItem>
            </MudGrid>
            <MudDivider />

            <MudPopover Open="@_isOpen" Class="px-4 pt-4">
                <div class="d-flex flex-column">
                    <AuthorMetadata AuthorName=@record.Name />
                    <MudButton OnClick="@ToggleOpen" Class="ml-auto mr-n3 mb-1" Color="Color.Error">Close</MudButton>
                </div>
            </MudPopover>
            break;
        case CalibreRecordType.Series:
            <h3>Author : @record.Books[0].Author</h3>
            <MudDivider />
            @if (seriesdata != null)
            {
                <h3>Series has @seriesdata.BookCount published books.</h3>
                <MudGrid>
                    <MudItem xs="8">
                        <h3>Description:</h3>
                        <MudText Typo="Typo.body1"> @((MarkupString)seriesdata.DescriptionHtml)</MudText>
                    </MudItem>
                </MudGrid>
            }
            <MudDivider />
            string url = record.Name.Replace(' ', '-');
            <a href="https://www.bookseriesinorder.com/@url" target="_blank"><img loading="lazy" src="https://www.bookseriesinorder.com/images/bsio-link.jpg" width="150" height="75"></a>

            <MudDivider />
            break;
        case CalibreRecordType.Category:
        case CalibreRecordType.Format:
        case CalibreRecordType.Publisher:
            <MudDivider />
            break;
    }
 
    <MudGrid>
        <MudItem xs="12">
            <MudGrid Spacing="2" Justify="Justify.FlexStart">
                @foreach (var book in record.Books)
                {
                    <BookCover BookItem=@book></BookCover>
                }
                <div id="observerTarget"></div>
            </MudGrid>
        </MudItem>
    </MudGrid>
}

@code{
    public bool _isOpen;

    public void ToggleOpen()
    {
        if (_isOpen)
            _isOpen = false;
        else
            _isOpen = true;
    }
}